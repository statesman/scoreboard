### Configuration

All configuration settings are stored in [`src/js/config.js`](src/js/config.js).

Setting up the regular season is as simple as setting the two variables at the top of that file, one for the number of weeks in the regular season and another for the first Friday of the regular season, which is what all of the other weeks will be calculated from.

You'll also need to include the base URL for your teamplayer gateway and the sport ID for football.

```javascript
var numWeeks = 11;
var firstFriday = moment('2014-08-29', 'YYYY-MM-DD');
var urlBase = 'http://teamplayer.statesman.com';
var sportId = '1';
```

### Teamplayer integration

This app relies on two TeamPlayer templates, one Web template, and one query template. Both are included below so changes to Teamplayer templates can be tracked along with changes to the app's code.

The production version of the app draws from the Web template `TickerJSON` and the dev version from `TickerJSON_clone`. Production queries are generated by `Ticker` and dev come from `TickerClone`.

#### Web templates

##### `TickerJSON_clone`
```php
<QUERY name=Sport SPORTID=$form_Sport>
<VAR $market = "">
<IFGREATER $form_Market 0>
  <VAR $market = $form_Market>
</IFGREATER>
<?php
  $scoreFields = array(
    "Football" => "TotalPoints",
    "Baseball" => "Runs",
    "Boys Basketball" => "TotalPoints",
    "Girls Basketball" => "TotalPoints",
    "Boys Hockey" => "TotalGoals",
    "Girls Hockey" => "TotalGoals",
    "Boys Soccer" => "TotalGoals",
    "Girls Soccer" => "TotalGoals",
    "Boys Volleyball" => "FinalScore",
    "Girls Volleyball" => "FinalScore",
    "Field Hockey" => "TotalGoals",
    "Softball" => "Runs",
    "Boys Lacrosse" => "TotalGoals",
    "Girls Lacrosse" => "TotalGoals"
  );
?>
<VAR $sportName = $Sport_SportName>
<VAR $sqlSportName = strtolower(convertForSQL($sportName))>
<VAR $scoreField = $scoreFields[$sportName]>
<QUERY name=TickerClone SPORTID=$form_Sport SPORTNAME=$sqlSportName SCOREFIELD=$scoreField STARTDATE=$form_StartDate ENDDATE=$form_EndDate MARKET=$market>
<?php header('Content-Type: application/json'); ?>
<?php

  // Loop through each of the data rows and set some custom fields
  foreach($TickerClone_rows as $key => $row) {

    // Make GameScoreIsFinal a boolean for easier templating
    if($row['GameScoreIsFinal'] === "1") {
      $TickerClone_rows[$key]['GameScoreIsFinal'] = TRUE;
    }
    else {
      $TickerClone_rows[$key]['GameScoreIsFinal'] = FALSE;
    }

    // Set a boolean for the winner that can be used during templating
    if($TickerClone_rows[$key]['GameScoreIsFinal']) {
      if(intval($row['AwayTeamScore']) > intval($row['HomeTeamScore'])) {
        $TickerClone_rows[$key]['AwayTeamWon'] = TRUE;
      }
      else {
        $TickerClone_rows[$key]['HomeTeamWon'] = TRUE;
      }
    }

    // Return the gametime as a UNIX timestamp for easier client-side parsing
    $timeStamp = strtotime($row['GameTime'] . ' ' . $row['GameDate']) + 3600;
    $TickerClone_rows[$key]['GameTimestamp'] = $timeStamp;
    unset($TickerClone_rows[$key]['GameTime']);
    unset($TickerClone_rows[$key]['GameDate']);

  }

  $json = json_encode($TickerClone_rows);
  if(array_key_exists('callback', $_GET)){
      $callback = $_GET['callback'];
      $json = $callback . '(' . $json . ');';
  }
  echo $json;
?>
```

##### `GameJSON`
```php
<QUERY name=Sport SPORTID=$form_Sport>
<?php
  $scoreFields = array(
    "Football" => "TotalPoints",
    "Baseball" => "Runs",
    "Boys Basketball" => "TotalPoints",
    "Girls Basketball" => "TotalPoints",
    "Boys Hockey" => "TotalGoals",
    "Girls Hockey" => "TotalGoals",
    "Boys Soccer" => "TotalGoals",
    "Girls Soccer" => "TotalGoals",
    "Boys Volleyball" => "FinalScore",
    "Girls Volleyball" => "FinalScore",
    "Field Hockey" => "TotalGoals",
    "Softball" => "Runs",
    "Boys Lacrosse" => "TotalGoals",
    "Girls Lacrosse" => "TotalGoals"
  );
?>
<VAR $sportName = $Sport_SportName>
<VAR $sqlSportName = strtolower(convertForSQL($sportName))>
<VAR $scoreField = $scoreFields[$sportName]>
<QUERY name=GameJSON GAMEID=$form_id  SPORTNAME=$sqlSportName SCOREFIELD=$scoreField>
<?php header('Content-Type: application/json'); ?>
<?php
  $json = json_encode($GameJSON_rows[0]);
  if(array_key_exists('callback', $_GET)){
      $callback = $_GET['callback'];
      $json = $callback . '(' . $json . ');';
  }
  echo $json;
?>
```

#### Query template

##### `TickerClone`
```sql
SELECT q_game.GameID,
  GameAwayTeamID,
  GameHomeTeamID,
  GameDate,
  GameTime,
  GameScoreIsFinal,
  GameLocation,
  away.TeamName AS AwayTeamName,
  home.TeamName AS HomeTeamName,
  away.TeamNickname AS AwayTeamNickname,
  home.TeamNickname AS HomeTeamNickname,
  awayscore.{$SCOREFIELD} AS AwayTeamScore,
  homescore.{$SCOREFIELD} AS HomeTeamScore,
  away.TeamID AS AwayTeamID,
  home.TeamID AS HomeTeamID,
  venue.SchoolName AS VenueName
FROM `q_game`
LEFT JOIN game ON q_game.GameID = game.GameID
LEFT JOIN team AS away ON away.TeamID = GameAwayTeamID
LEFT JOIN team AS home ON home.TeamID = GameHomeTeamID
LEFT JOIN school AS venue ON game.GameLocation = venue.SchoolID
LEFT JOIN gameteam{$SPORTNAME} as awayscore ON awayscore.GameTeamTeamID = GameAwayTeamID AND awayscore.GameTeamGameID = q_game.GameID
LEFT JOIN gameteam{$SPORTNAME} as homescore ON homescore.GameTeamTeamID = GameHomeTeamID AND homescore.GameTeamGameID = q_game.GameID WHERE GameActive = 1 AND GameSportID = {$SPORTID} AND GameDate >= '{$STARTDATE}' AND GameDate <= '{$ENDDATE}'
```

##### `GameJSON`
```sql
SELECT q_game.GameID,
  GameAwayTeamID,
  GameHomeTeamID,
  GameDate,
  GameTime,
  GameScoreIsFinal,
  GameLocation,
  away.TeamName AS AwayTeamName,
  home.TeamName AS HomeTeamName,
  away.TeamNickname AS AwayTeamNickname,
  home.TeamNickname AS HomeTeamNickname,
  awayscore.{$SCOREFIELD} AS AwayTeamScore,
  homescore.{$SCOREFIELD} AS HomeTeamScore,
  away.TeamID AS AwayTeamID,
  home.TeamID AS HomeTeamID,
  venue.SchoolName AS VenueName
FROM `q_game`
LEFT JOIN game ON q_game.GameID = game.GameID
LEFT JOIN team AS away ON away.TeamID = GameAwayTeamID
LEFT JOIN team AS home ON home.TeamID = GameHomeTeamID
LEFT JOIN school AS venue ON game.GameLocation = venue.SchoolID
LEFT JOIN gameteam{$SPORTNAME} as awayscore ON awayscore.GameTeamTeamID = GameAwayTeamID AND awayscore.GameTeamGameID = q_game.GameID
LEFT JOIN gameteam{$SPORTNAME} as homescore ON homescore.GameTeamTeamID = GameHomeTeamID AND homescore.GameTeamGameID = q_game.GameID
WHERE q_game.GameID = {$GAMEID}
```
