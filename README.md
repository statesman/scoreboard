### Teamplayer integration

This app relies on two TeamPlayer templates, one Web template, and one query template. Both are included below so changes to Teamplayer templates can be tracked along with changes to the app's code.

The production version of the app draws from the Web template `TickerJSON` and the dev version from `TickerJSON_clone`. Production queries are generated by `Ticker` and dev come from `TickerClone` for the below fields:

| AwaySchoolCity
| AwaySchoolState
| AwaySchoolZip
| AwayTeamID
| AwayTeamName
| AwayTeamNickname
| AwayTeamScore
| GameAwayTeamID
| GameDate
| GameHomeTeamID
| GameID
| GameIsTop
| GameLocation
| GamePostponed
| GameScoreIsFinal
| GameTime
| GameTimeTBD
| HomeSchoolCity
| HomeSchoolState
| HomeSchoolZip
| HomeTeamID
| HomeTeamName
| HomeTeamNickname
| HomeTeamScore
| venueName

#### Web template
```php
<QUERY name=Sport SPORTID=$form_Sport>
<VAR $market = "">
<IFGREATER $form_Market 0>
<VAR $market = $form_Market>
</IFGREATER>
<?PHP $scoreFields = array("Football" => "TotalPoints",
"Baseball" => "Runs",
"Boys Basketball" => "TotalPoints",
"Girls Basketball" => "TotalPoints",
"Boys Hockey" => "TotalGoals",
"Girls Hockey" => "TotalGoals",
"Boys Soccer" => "TotalGoals",
"Girls Soccer" => "TotalGoals",
"Boys Volleyball" => "FinalScore",
"Girls Volleyball" => "FinalScore",
"Field Hockey" => "TotalGoals",
"Softball" => "Runs",
"Boys Lacrosse" => "TotalGoals",
"Girls Lacrosse" => "TotalGoals"); ?>
<?PHP $periodTrans = array("1st quarter" => "Q1",
"2nd quarter" => "Q2",
"3rd quarter" => "Q3",
"4th quarter" => "Q4",
"Overtime" => "OT",
"" => ""); ?>
<VAR $sportName = $Sport_SportName>
<VAR $sqlSportName = strtolower(convertForSQL($sportName))>
<VAR $scoreField = $scoreFields[$sportName]>
<QUERY name=TickerClone SPORTID=$form_Sport SPORTNAME=$sqlSportName SCOREFIELD=$scoreField STARTDATE=$form_StartDate ENDDATE=$form_EndDate MARKET=$market>
<?php header('Content-Type: application/json'); ?>

<?php
$json = json_encode($TickerClone_rows);
if(array_key_exists('callback', $_GET)){
    $callback = $_GET['callback'];
    $json = $callback . '(' . $json . ');';
}
echo $json;
?>
```

#### Query template
```sql
SELECT q_game.GameID,
  GameAwayTeamID,
  GameHomeTeamID,
  GameDate,
  GameTime,
  GameTimeTBD,
  GameScoreIsFinal,
  GameIsTop,
  GamePostponed,
  GameLocation,
  away.TeamName AS AwayTeamName,
  home.TeamName AS HomeTeamName,
  away.TeamNickname AS AwayTeamNickname,
  home.TeamNickname AS HomeTeamNickname,
  awayscore.{$SCOREFIELD} AS AwayTeamScore,
  homescore.{$SCOREFIELD} AS HomeTeamScore,
  away.TeamID AS AwayTeamID,
  home.TeamID AS HomeTeamID,
  aways.SchoolCity AS AwaySchoolCity,
  homes.SchoolCity AS HomeSchoolCity,
  aways.SchoolState AS AwaySchoolState,
  homes.SchoolState AS HomeSchoolState,
  aways.SchoolZip AS AwaySchoolZip,
  homes.SchoolZip AS HomeSchoolZip,
  venue.SchoolName AS VenueName
FROM `q_game`
LEFT JOIN game ON q_game.GameID = game.GameID
LEFT JOIN team AS away ON away.TeamID = GameAwayTeamID
LEFT JOIN team AS home ON home.TeamID = GameHomeTeamID
LEFT JOIN school AS aways ON aways.SchoolID = away.TeamSchoolID
LEFT JOIN school AS homes ON homes.SchoolID = home.TeamSchoolID
LEFT JOIN school AS venue ON game.GameLocation = venue.SchoolID
LEFT JOIN gameteam{$SPORTNAME} as awayscore ON awayscore.GameTeamTeamID = GameAwayTeamID AND awayscore.GameTeamGameID = q_game.GameID
LEFT JOIN gameteam{$SPORTNAME} as homescore ON homescore.GameTeamTeamID = GameHomeTeamID AND homescore.GameTeamGameID = q_game.GameID WHERE GameActive = 1 AND GameSportID = {$SPORTID} AND GameDate >= '{$STARTDATE}' AND GameDate <= '{$ENDDATE}'
```
